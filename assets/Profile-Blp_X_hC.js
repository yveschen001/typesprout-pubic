const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/env-BTJqVy3E.js","assets/index-D4RQrBUQ.js","assets/index-ltVW486p.css"])))=>i.map(i=>d[i]);
import{u as ae,r as d,j as e,c as ge,b as ve,y as be,d as w,e as v,z as je,T as z,L as Ne,A as ye,C as Ce,B as k,g as V,_ as K,k as O,m as Y,D as we,E as Ae,F as Se,G as ke}from"./index-D4RQrBUQ.js";import{C as Ee,S as De,A as Te}from"./ChartSection-x7vIRUtL.js";import{g as Re}from"./index-eKjPdLg9.js";import{f as Me,u as Be}from"./useQuestionBank-uJQo5RO7.js";import"./env-BTJqVy3E.js";const U={children:{name:"å…’ç«¥é¡Œåº«",icon:"ğŸŒ±",color:"green",gradeRange:[1,6],description:"é©åˆå…’ç«¥çš„åŸºç¤æ‰“å­—ç·´ç¿’"},bible:{name:"è–ç¶“é¡Œåº«",icon:"ğŸ“–",color:"blue",gradeRange:[7,12],description:"è–ç¶“ç¶“æ–‡æ‰“å­—ç·´ç¿’"}};function ee(t){return U[t]}function Pe({selectedBank:t,onBankChange:i,userGrade:u,className:P=""}){const{t:j}=ae(),[F,J]=d.useState(null),[o,b]=d.useState(!0),[$,_]=d.useState(null);d.useEffect(()=>{(async()=>{try{b(!0),_(null);const h=await Me();J(h)}catch(h){console.error("[QuestionBankSelector] Error loading meta:",h),_("è¼‰å…¥é¡Œåº«è³‡è¨Šå¤±æ•—")}finally{b(!1)}})()},[]);const q=()=>u?Object.keys(U).filter(p=>{const h=ee(p);return u>=h.gradeRange[0]&&u<=h.gradeRange[1]}):Object.keys(U),D=p=>F?!!F.questionBanks[p]:!0;if(o)return e.jsx("div",{className:`p-4 ${P}`,children:e.jsx("div",{className:"text-center text-gray-600",children:j("questionBank.loading","è¼‰å…¥é¡Œåº«ä¸­...")})});if($)return e.jsx("div",{className:`p-4 ${P}`,children:e.jsx("div",{className:"text-center text-red-600",children:$})});const L=q(),I=Object.keys(U).filter(D);return e.jsxs("div",{className:`space-y-4 ${P}`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:j("questionBank.title","é¸æ“‡é¡Œåº«")}),e.jsx("p",{className:"text-sm text-gray-600",children:j("questionBank.subtitle","é¸æ“‡é©åˆä½ çš„ç·´ç¿’é¡Œåº«")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:I.map(p=>{const h=ee(p);L.includes(p);const T=t===p,A=F?.questionBanks[p];return e.jsxs("div",{className:`
                relative p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                ${T?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"}
                ${D(p)?"":"opacity-50 cursor-not-allowed"}
              `,onClick:()=>D(p)&&i(p),children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-2xl",children:h.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-1",children:j(`questionBank.${p}.name`,h.name)}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:j(`questionBank.${p}.description`,h.description)}),A&&e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:[j("questionBank.gradeRange","å¹´ç´šç¯„åœ"),": ",h.gradeRange[0],"-",h.gradeRange[1]]}),e.jsxs("div",{children:[j("questionBank.supportedLanguages","æ”¯æ´èªè¨€"),": ",A.langs.length]}),e.jsxs("div",{children:[j("questionBank.totalQuestions","ç¸½é¡Œæ•¸"),": ",Object.values(A.filesPerLang).reduce((N,y)=>N+y,0)*A.pageSize]})]})]})]}),T&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]},p)})}),u&&L.length===0&&e.jsx("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:j("questionBank.noRecommendation","ç›®å‰æ²’æœ‰é©åˆä½ å¹´ç´šçš„æ¨è–¦é¡Œåº«")})})]})}function Ie(){const{t}=ae(),{user:i}=ge(),{lang:u}=ve(),P=be(),{currentBank:j,switchQuestionBank:F,loading:J}=Be(),[o,b]=d.useState({}),[$,_]=d.useState(!1),[q,D]=d.useState({}),[L,I]=d.useState([]),[p,h]=d.useState([]),T=/^(?=.{3,50}$)(?!.*\/).+$/,A=5,[N,y]=d.useState("idle"),[Fe,te]=d.useState(""),[H,W]=d.useState([]),[X,re]=d.useState(!1),[Z,se]=d.useState(!1),C=d.useRef(null);function oe(a){if(!a)return 0;const r=String(a).replace(/[^0-9]/g,"");let n=0,c=1;if(/^[0-9]{6,}$/.test(r))n=Number(r.slice(0,4)),c=Number(r.slice(4,6))||1;else{const g=/^([0-9]{4})-([0-9]{2})$/.exec(a);if(!g)return 0;n=Number(g[1]),c=Number(g[2])||1}c=Math.min(12,Math.max(1,c));const s=new Date(n,c-1,1),f=new Date;let l=f.getFullYear()-s.getFullYear();const x=f.getMonth()-s.getMonth();return(x<0||x===0&&f.getDate()<1)&&(l-=1),Math.max(0,l)}const ne=oe(o.dobYM),le=o.role==="teacher"&&ne>=21,ie=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,ce=(()=>{const a=new Date;return a.setFullYear(a.getFullYear()-2),ie(a)})(),de="1900-01",Q=a=>{if(!a)return;const r=document.documentElement;r.setAttribute("lang",a),r.setAttribute("dir",ke(a)?"rtl":"ltr"),r.lang=a,document.body.setAttribute("lang",a);let n=document.querySelector('meta[name="language"]');n||(n=document.createElement("meta"),n.setAttribute("name","language"),document.head.appendChild(n)),n.setAttribute("content",a),document.querySelectorAll('input[type="month"]').forEach(s=>{s.setAttribute("lang",a),s.setAttribute("data-lang",a),s.removeAttribute("lang"),s.setAttribute("lang",a)}),C.current&&(C.current.setAttribute("lang",a),C.current.setAttribute("data-lang",a),C.current.removeAttribute("lang"),C.current.setAttribute("lang",a))};d.useEffect(()=>{u&&Q(u)},[u]),d.useEffect(()=>{C.current&&u&&(C.current.setAttribute("lang",u),C.current.setAttribute("data-lang",u))},[u,o.dobYM]),d.useEffect(()=>{u&&setTimeout(()=>{Q(u)},100)},[]),d.useEffect(()=>{if(!i)return;const a=w(v,"profiles",i.uid),r=je(a,c=>{const s=c.data(),f=Array.isArray(s?.classCodes)?s.classCodes:[],l=String(s?.classCode||"").trim(),x=f.length?f:l?[l]:[];b({displayName:s?.displayName||i.displayName||"",grade:s?.grade,gender:s?.gender||"U",dobYM:s?.dobYM||"",role:s?.role||"student",country:s?.country||void 0,classCode:s?.classCode||"",classCodes:x}),te(String(s?.classCode||"")),D(g=>({...g,xp:s?.xp||0,points:s?.points||0}))},c=>{console.error("Error listening to profile changes:",c)});return(async()=>{try{const c=w(v,"fruits",i.uid),s=await V(c);D(f=>({...f,fruits:s.exists()?Number(s.data().total||0):0}))}catch{}})(),()=>r()},[i]),d.useEffect(()=>{async function a(){if(i)try{console.log("Profile: Getting attempts for user:",i.uid);const r=await Re({uid:i.uid,days:30,sampleLimit:50});console.log("Profile: Found",r.length,"attempts");const n=r.slice().reverse(),c=l=>{try{if(!l)return;if(typeof l=="number")return new Date(l);if(l&&typeof l=="object"&&"toDate"in l){const x=l.toDate;return typeof x=="function"?x():void 0}}catch{}},s=n.map((l,x)=>({i:x,adj:Number(l.adjWpm||0),ts:c(l.ts),durationSec:Number(l.durationSec||0),rawChars:Number(l.rawChars||0),accuracy:Math.max(0,Math.min(1,Number(l.accuracy||0))),totalQChars:Array.isArray(l.questions)?l.questions.reduce((g,S)=>g+Number(S.chars||0),0):0})),f=n.map((l,x)=>({i:x,acc:Math.max(0,Math.min(1,Number(l.accuracy||0))),ts:c(l.ts),durationSec:Number(l.durationSec||0),rawChars:Number(l.rawChars||0),adj:Number(l.adjWpm||0),totalQChars:Array.isArray(l.questions)?l.questions.reduce((g,S)=>g+Number(S.chars||0),0):0}));console.log("Profile data arrays:",{adj:s.length,acc:f.length}),I(s),h(f)}catch(r){console.error("Error loading profile data:",r),I([]),h([])}}a()},[i]),d.useEffect(()=>{let a=!0;const n=setTimeout(async()=>{const s=(o.classCode||"").trim().replace(/[ï¼â€”â€“]/g,"-");if(!s){a&&y("idle");return}if(!T.test(s)){a&&y("invalid");return}a&&y("checking");try{const{getDoc:f,doc:l}=await K(async()=>{const{getDoc:R,doc:M}=await import("./env-BTJqVy3E.js").then(m=>m.i);return{getDoc:R,doc:M}},__vite__mapDeps([0,1,2])),{db:x}=await K(async()=>{const{db:R}=await import("./index-D4RQrBUQ.js").then(M=>M.ap);return{db:R}},__vite__mapDeps([1,2])),g=l(x,"classCodes",s),S=await f(g);if(!a)return;if(!S.exists())y("available");else{const R=S.data()?.owner;i&&R===i.uid?y("mine"):y("taken")}}catch{a&&y("error")}},300);return()=>{a=!1,clearTimeout(n)}},[o.classCode,i]);async function ue(){if(!i)return;_(!0);const a=w(v,"profiles",i.uid);await O(a,{...o,updatedAt:Y()},{merge:!0}),_(!1);try{const r=document.createElement("div");r.role="status",r.setAttribute("aria-live","polite"),r.textContent="Loading...",r.style.position="fixed",r.style.right="16px",r.style.bottom="16px",r.style.background="#111827",r.style.color="#fff",r.style.padding="8px 12px",r.style.borderRadius="8px",r.style.boxShadow="0 2px 8px rgba(0,0,0,.2)",document.body.appendChild(r),setTimeout(()=>{try{document.body.removeChild(r)}catch{}},1600)}catch{}}return i?e.jsxs("div",{className:"max-w-[960px] mx-auto px-4",children:[e.jsx("h2",{className:"h2 mb-3",children:t("profile.title")}),e.jsxs("div",{className:"mb-3 body muted",children:[t("profile.googleAccount"),": ",i.email]}),e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsxs("div",{className:"p-3 border border-[var(--color-border,#e5e7eb)] rounded-[12px]",children:[e.jsxs("div",{className:"text-[12px] text-[var(--color-muted,#6b7280)] flex items-center gap-1",children:[t("profile.xp"),e.jsx(z,{label:t("profile.xpTooltip"),children:"?"})]}),e.jsx("div",{className:"text-[20px] font-semibold",children:q.xp??"â€”"})]}),e.jsxs("div",{className:"p-3 border border-[var(--color-border,#e5e7eb)] rounded-[12px]",children:[e.jsxs("div",{className:"text-[12px] text-[var(--color-muted,#6b7280)] flex items-center gap-1",children:[t("profile.points"),e.jsx(z,{label:t("profile.pointsTooltip"),children:"?"})]}),e.jsx("div",{className:"text-[20px] font-semibold",children:q.points??"â€”"})]}),e.jsxs("div",{className:"p-3 border border-[var(--color-border,#e5e7eb)] rounded-[12px]",children:[e.jsxs("div",{className:"text-[12px] text-[var(--color-muted,#6b7280)] flex items-center gap-1",children:[t("profile.fruits"),e.jsx(z,{label:t("profile.fruitsTooltip"),children:"?"})]}),e.jsx("div",{className:"text-[20px] font-semibold",children:q.fruits??0})]})]}),e.jsxs("div",{className:"mb-4 text-[12px] text-[var(--color-muted,#6b7280)]",children:[t("profile.pointsDetail")," ",e.jsx(Ne,{to:`/${u}/garden`,className:"underline",children:t("nav.garden")})," â†’ ",t("profile.history")," ",t("profile.view")]}),e.jsxs("div",{className:"grid gap-3 max-w-[560px]",children:[e.jsxs("label",{children:[e.jsx("div",{className:"mb-1 text-[14px] text-[var(--color-muted,#6b7280)]",children:t("profile.nickname")}),e.jsx("input",{"aria-label":"Nickname",value:o.displayName||"",onChange:a=>b({...o,displayName:a.target.value}),className:"w-full h-11 rounded-[12px] border border-[var(--color-border,#e5e7eb)] px-3"})]}),e.jsxs("label",{children:[e.jsx("div",{className:"mb-1 text-[14px] text-[var(--color-muted,#6b7280)]",children:t("profile.country")}),e.jsxs("select",{"aria-label":"Country",value:o.country||"",onChange:a=>b({...o,country:a.target.value||void 0}),className:"w-full h-11 rounded-[12px] border border-[var(--color-border,#e5e7eb)] px-3",children:[e.jsx("option",{value:"",children:t("profile.auto")}),(()=>{const a=ye(u),r=Ce.map(s=>s.code),n=a.filter(s=>r.includes(s.code)),c=a.filter(s=>!r.includes(s.code));return[...n,...c].map(s=>e.jsxs("option",{value:s.code,children:[s.code," â€” ",s.name]},s.code))})()]})]}),e.jsxs("label",{children:[e.jsx("div",{className:"mb-1 text-[14px] text-[var(--color-muted,#6b7280)]",children:t("profile.gender")}),e.jsxs("select",{"aria-label":"Gender",value:o.gender,onChange:a=>b({...o,gender:a.target.value}),className:"w-full h-11 rounded-[12px] border border-[var(--color-border,#e5e7eb)] px-3",children:[e.jsx("option",{value:"U",children:t("profile.other")}),e.jsx("option",{value:"M",children:t("profile.male")}),e.jsx("option",{value:"F",children:t("profile.female")}),e.jsx("option",{value:"N",children:t("profile.other")})]})]}),e.jsxs("label",{children:[e.jsx("div",{className:"mb-1 text-[14px] text-[var(--color-muted,#6b7280)]",children:t("profile.birthday")}),e.jsx("input",{ref:C,"aria-label":"DOB",type:"month",value:(o.dobYM||"").replace(/[^0-9-]/g,""),onChange:a=>b({...o,dobYM:a.target.value}),min:de,max:ce,className:"w-full h-11 rounded-[12px] border border-[var(--color-border,#e5e7eb)] px-3",lang:u,"data-lang":u})]}),e.jsxs("label",{children:[e.jsx("div",{className:"mb-1 text-[14px] text-[var(--color-muted,#6b7280)]",children:t("profile.role")}),e.jsxs("select",{"aria-label":"Role",value:o.role,onChange:a=>b({...o,role:a.target.value}),className:"w-full h-11 rounded-[12px] border border-[var(--color-border,#e5e7eb)] px-3",children:[e.jsx("option",{value:"student",children:t("profile.student")}),e.jsx("option",{value:"teacher",children:t("profile.teacher")}),e.jsx("option",{value:"parent",children:t("profile.other")}),e.jsx("option",{value:"other",children:t("profile.other")})]})]}),e.jsxs("label",{children:[e.jsxs("div",{className:"mb-1 text-[14px] text-[var(--color-muted,#6b7280)]",children:[t("profile.classCode")," ",e.jsx(z,{label:t("profile.classCodeTooltip"),children:"ï¼Ÿ"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("input",{"aria-label":t("profile.classCode"),value:o.classCode||"",onChange:a=>b({...o,classCode:a.target.value}),placeholder:t("profile.classCodePlaceholder"),className:"h-11 rounded-[12px] border border-[var(--color-border,#e5e7eb)] px-3 w-[220px] sm:w-[260px]"}),e.jsxs("div",{className:"text-xs min-w-[88px] text-center",children:[N==="checking"&&e.jsx("span",{className:"text-[var(--color-muted,#6b7280)]",children:"Checking..."}),N==="invalid"&&e.jsx("span",{className:"text-[var(--color-danger,#ef4444)]",children:"Length must be 3â€“50 and cannot contain /"}),N==="error"&&e.jsx("span",{className:"text-[var(--color-danger,#ef4444)]",children:t("profile.error")}),N==="taken"&&e.jsx("span",{className:"text-[var(--color-danger,#ef4444)]",children:t("profile.alreadyTaken")}),N==="mine"&&e.jsx("span",{className:"text-[var(--color-success,#16a34a)]",children:t("profile.youOwnThis")}),N==="available"&&e.jsx("span",{className:"text-[var(--color-success,#16a34a)]",children:t("profile.available")})]}),le&&e.jsx(k,{variant:"outline",onClick:async()=>{try{if(!i){console.error("[Profile] No user found"),alert(t("profile.noUser"));return}try{if(((await V(w(v,"profiles",i.uid))).data()?.role||"student")!=="teacher"){alert(t("profile.onlyTeacherCanCreate"));return}}catch(m){console.error("[Profile] Error checking user role:",m),alert(t("profile.roleCheckError"));return}const a=(o.classCode||"").trim().replace(/[ï¼â€”â€“]/g,"-");if(!T.test(a)){alert(t("profile.invalidCodeFormat"));return}if(N==="taken"){alert(t("profile.codeAlreadyTaken"));return}const{getDocs:r,query:n,where:c,collection:s,limit:f,runTransaction:l,doc:x,serverTimestamp:g}=await K(async()=>{const{getDocs:m,query:E,where:B,collection:G,limit:me,runTransaction:pe,doc:fe,serverTimestamp:xe}=await import("./env-BTJqVy3E.js").then(he=>he.i);return{getDocs:m,query:E,where:B,collection:G,limit:me,runTransaction:pe,doc:fe,serverTimestamp:xe}},__vite__mapDeps([0,1,2])),S=n(s(v,"classCodes"),c("owner","==",i.uid),f(A+1));if((await r(S)).size>=A){alert(t("profile.maxClassesReached"));return}const M=x(v,"classCodes",a);await l(v,async m=>{if((await m.get(M)).exists())throw new Error("taken");m.set(M,{owner:i.uid,createdAt:g()})}),console.log("[Profile] Class code created successfully:",a);try{const m=Array.isArray(o.classCodes)?o.classCodes.slice():[];if(m.includes(a))console.log("[Profile] Already in class list");else if(m.length>=5)alert(t("profile.maxJoinedClasses"));else{const E=x(v,"profiles",i.uid),B=Array.from(new Set([...m,a]));await O(E,{classCodes:B,updatedAt:g()},{merge:!0}),b(G=>({...G,classCodes:B})),alert(t("profile.classCreatedAndJoined"))}}catch(m){console.error("[Profile] Error joining created class:",m),alert(t("profile.joinError"))}try{const m=n(s(v,"classCodes"),c("owner","==",i.uid)),E=await r(m);W(E.docs.map(B=>B.id))}catch(m){console.error("[Profile] Error updating class list:",m)}}catch(a){const r=a&&typeof a=="object"&&"message"in a?String(a.message):"";console.error("[Profile] Create class error:",a),alert(r==="taken"?t("profile.codeAlreadyTaken"):t("profile.createError",{error:r}))}},children:t("profile.create")}),e.jsx(k,{onClick:async()=>{try{if(!i){console.error("[Profile] No user found for join"),alert(t("profile.noUser"));return}const r=(o.classCode||"").trim().replace(/[ï¼â€”â€“]/g,"-");if(!T.test(r)){alert(t("profile.invalidCodeFormat"));return}if(!(await V(w(v,"classCodes",r))).exists()){alert(t("profile.classNotFound"));return}const c=Array.isArray(o.classCodes)?o.classCodes.slice(0):[];if(c.includes(r)){alert(t("profile.alreadyJoined"));return}if(c.length>=5){alert(t("profile.maxJoinedClasses"));return}const s=w(v,"profiles",i.uid),f=Array.from(new Set([...c,r]));await O(s,{classCodes:f,updatedAt:Y()},{merge:!0}),b(l=>({...l,classCodes:f})),console.log("[Profile] Successfully joined class:",r),alert(t("profile.joinSuccess"))}catch(a){console.error("[Profile] Join class error:",a),alert(t("profile.joinError"))}},children:t("profile.join")})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{type:"button",className:"text-[14px] underline text-[var(--color-muted,#6b7280)]",onClick:()=>re(a=>!a),"aria-expanded":X,children:[t("profile.myClasses")," (",H.length,"/",A,")"]}),X&&e.jsxs("div",{className:"mt-2 border border-[var(--color-border,#e5e7eb)] rounded-[12px] p-2",children:[H.length===0&&e.jsx("div",{className:"text-[12px] text-[var(--color-muted,#6b7280)]",children:t("profile.noClasses")}),e.jsx("div",{className:"flex flex-col gap-2",children:H.map(a=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"font-mono text-[14px] break-all",children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(a),alert(t("profile.copySuccess"))}catch{alert(t("profile.copyFailed"))}},children:t("profile.copy")}),e.jsx(k,{variant:"outline",size:"sm",onClick:async()=>{try{if(!i||!confirm(t("profile.confirmDelete")))return;await we(w(v,"classCodes",a)),W(r=>r.filter(n=>n!==a))}catch{alert("Error occurred")}},children:t("profile.delete")})]})]},a))})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{type:"button",className:"text-[14px] underline text-[var(--color-muted,#6b7280)]",onClick:()=>se(a=>!a),"aria-expanded":Z,children:[t("profile.joinedClasses")," (",Array.isArray(o.classCodes)?o.classCodes.length:0,"/5)"]}),Z&&e.jsxs("div",{className:"mt-2 border border-[var(--color-border,#e5e7eb)] rounded-[12px] p-2",children:[(!Array.isArray(o.classCodes)||o.classCodes.length===0)&&e.jsx("div",{className:"text-[12px] text-[var(--color-muted,#6b7280)]",children:t("profile.noClasses")}),e.jsx("div",{className:"flex flex-col gap-2",children:(Array.isArray(o.classCodes)?o.classCodes:[]).map(a=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"font-mono text-[14px] break-all",children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(a),alert(t("profile.copySuccess"))}catch{alert(t("profile.copyFailed"))}},children:t("profile.copy")}),e.jsx(k,{variant:"outline",size:"sm",onClick:async()=>{try{if(!i)return;const r=(Array.isArray(o.classCodes)?o.classCodes:[]).filter(n=>n!==a);await O(w(v,"profiles",i.uid),{classCodes:r,updatedAt:Y()},{merge:!0}),b(n=>({...n,classCodes:r}))}catch{alert("Error occurred")}},children:t("profile.remove")})]})]},a))})]})]})]}),e.jsxs("label",{children:[e.jsx("div",{className:"mb-1 text-[14px] text-[var(--color-muted,#6b7280)]",children:t("profile.language")}),e.jsx("select",{"aria-label":"Language",value:u,onChange:async a=>{const r=a.target.value;try{if(Q(r),localStorage.setItem("typesprout_lang",r),i)try{const n=w(v,"profiles",i.uid);await O(n,{lang:r,updatedAt:Y()},{merge:!0}),console.log("Language saved to Firebase:",r)}catch(n){console.error("Failed to save language to Firebase:",n)}P(`/${r}/profile`,{replace:!0})}catch(n){console.error("Language change failed:",n)}},className:"w-full h-11 rounded-[12px] border border-[var(--color-border,#e5e7eb)] px-3",children:Ae.map(a=>{const r=[{code:"en-US",name:"English",nativeName:"English",flag:"ğŸ‡ºğŸ‡¸"},{code:"zh-TW",name:"Chinese (Traditional)",nativeName:"ç¹é«”ä¸­æ–‡",flag:"ğŸ‡¹ğŸ‡¼"},{code:"zh-CN",name:"Chinese (Simplified)",nativeName:"ç®€ä½“ä¸­æ–‡",flag:"ğŸ‡¨ğŸ‡³"},{code:"es-MX",name:"Spanish",nativeName:"EspaÃ±ol",flag:"ğŸ‡²ğŸ‡½"},{code:"pt-BR",name:"Portuguese",nativeName:"PortuguÃªs",flag:"ğŸ‡§ğŸ‡·"},{code:"ja-JP",name:"Japanese",nativeName:"æ—¥æœ¬èª",flag:"ğŸ‡¯ğŸ‡µ"},{code:"ko-KR",name:"Korean",nativeName:"í•œêµ­ì–´",flag:"ğŸ‡°ğŸ‡·"},{code:"fr-FR",name:"French",nativeName:"FranÃ§ais",flag:"ğŸ‡«ğŸ‡·"},{code:"de-DE",name:"German",nativeName:"Deutsch",flag:"ğŸ‡©ğŸ‡ª"},{code:"it-IT",name:"Italian",nativeName:"Italiano",flag:"ğŸ‡®ğŸ‡¹"},{code:"id-ID",name:"Indonesian",nativeName:"Bahasa Indonesia",flag:"ğŸ‡®ğŸ‡©"},{code:"vi-VN",name:"Vietnamese",nativeName:"Tiáº¿ng Viá»‡t",flag:"ğŸ‡»ğŸ‡³"},{code:"th-TH",name:"Thai",nativeName:"à¹„à¸—à¸¢",flag:"ğŸ‡¹ğŸ‡­"},{code:"ru-RU",name:"Russian",nativeName:"Ğ ÑƒÑÑĞºĞ¸Ğ¹",flag:"ğŸ‡·ğŸ‡º"},{code:"ar-SA",name:"Arabic",nativeName:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ğŸ‡¸ğŸ‡¦"},{code:"fil-PH",name:"Filipino",nativeName:"Filipino",flag:"ğŸ‡µğŸ‡­"},{code:"nl-NL",name:"Dutch",nativeName:"Nederlands",flag:"ğŸ‡³ğŸ‡±"},{code:"pl-PL",name:"Polish",nativeName:"Polski",flag:"ğŸ‡µğŸ‡±"},{code:"sv-SE",name:"Swedish",nativeName:"Svenska",flag:"ğŸ‡¸ğŸ‡ª"},{code:"nb-NO",name:"Norwegian",nativeName:"Norsk",flag:"ğŸ‡³ğŸ‡´"},{code:"da-DK",name:"Danish",nativeName:"Dansk",flag:"ğŸ‡©ğŸ‡°"},{code:"fi-FI",name:"Finnish",nativeName:"Suomi",flag:"ğŸ‡«ğŸ‡®"},{code:"ro-RO",name:"Romanian",nativeName:"RomÃ¢nÄƒ",flag:"ğŸ‡·ğŸ‡´"},{code:"el-GR",name:"Greek",nativeName:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",flag:"ğŸ‡¬ğŸ‡·"},{code:"cs-CZ",name:"Czech",nativeName:"ÄŒeÅ¡tina",flag:"ğŸ‡¨ğŸ‡¿"},{code:"hu-HU",name:"Hungarian",nativeName:"Magyar",flag:"ğŸ‡­ğŸ‡º"},{code:"uk-UA",name:"Ukrainian",nativeName:"Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°",flag:"ğŸ‡ºğŸ‡¦"},{code:"ms-MY",name:"Malay",nativeName:"Bahasa Melayu",flag:"ğŸ‡²ğŸ‡¾"},{code:"hi-IN",name:"Hindi",nativeName:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ğŸ‡®ğŸ‡³"},{code:"bn-BD",name:"Bengali",nativeName:"à¦¬à¦¾à¦‚à¦²à¦¾",flag:"ğŸ‡§ğŸ‡©"},{code:"he-IL",name:"Hebrew",nativeName:"×¢×‘×¨×™×ª",flag:"ğŸ‡®ğŸ‡±"},{code:"fa-IR",name:"Persian",nativeName:"ÙØ§Ø±Ø³ÛŒ",flag:"ğŸ‡®ğŸ‡·"},{code:"ur-PK",name:"Urdu",nativeName:"Ø§Ø±Ø¯Ùˆ",flag:"ğŸ‡µğŸ‡°"},{code:"tr-TR",name:"Turkish",nativeName:"TÃ¼rkÃ§e",flag:"ğŸ‡¹ğŸ‡·"}].find(n=>n.code===a);return r?e.jsxs("option",{value:a,children:[r.flag," ",r.nativeName," (",r.name,")"]},a):e.jsx("option",{value:a,children:a},a)})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Pe,{selectedBank:j,onBankChange:F,userGrade:o.grade,className:"border border-[var(--color-border,#e5e7eb)] rounded-[12px] p-4"})}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(k,{onClick:()=>void ue(),disabled:$||J,children:t("profile.save")}),e.jsx(k,{variant:"outline",onClick:()=>void Se(),children:t("profile.logout")})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mb-2 text-[var(--color-muted,#6b7280)]",children:t("profile.analysis")}),e.jsx("div",{className:"flex flex-wrap gap-6 items-start",children:e.jsxs(Ee,{topText:t("profile.chartDescription"),children:[e.jsx(De,{data:L.length?L:Array.from({length:20},(a,r)=>({i:r,adj:0}))}),e.jsx("div",{className:"h-3"}),e.jsx(Te,{data:p.length?p:Array.from({length:20},(a,r)=>({i:r,acc:0}))})]})})]})]}):e.jsx("div",{className:"max-w-[960px] mx-auto px-4",children:t("ui.loading")})}export{Ie as default};
