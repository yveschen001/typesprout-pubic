import{q as b,f as w,e as A,w as E,o as v,n as L,i as D,u as S,c as U,r as o,j as e,B as f}from"./index-D4RQrBUQ.js";async function u(a=1e3){try{const n=b(w(A,"profiles"),E("email","!=",""),v("email"),L(a)),i=await D(n);console.log("getAllUserEmails: fetched profiles:",i.docs.length);const s=[];for(const l of i.docs){const r=l.data();r.email&&r.email.trim()!==""&&s.push({uid:l.id,email:r.email,displayName:r.displayName||"",createdAt:r.createdAt,lastLogin:r.updatedAt})}return console.log("getAllUserEmails: valid users with email:",s.length),s}catch(n){throw console.error("getAllUserEmails: error:",n),new Error("获取用户email列表失败")}}async function k(){try{const a=await u(),n=`UID,Email,Display Name,Created At,Last Login
`,i=a.map(s=>{const l=s.createdAt?s.createdAt.toDate?s.createdAt.toDate().toISOString():s.createdAt:"",r=s.lastLogin?s.lastLogin.toDate?s.lastLogin.toDate().toISOString():s.lastLogin:"";return`${s.uid},"${s.email}","${s.displayName}","${l}","${r}"`}).join(`
`);return n+i}catch(a){throw console.error("exportUserEmailsCSV: error:",a),new Error("导出用户email列表失败")}}function $(){const{t:a}=S(),{user:n}=U(),[i,s]=o.useState([]),[l,r]=o.useState(!1),[p,d]=o.useState(""),[g,h]=o.useState(!1),m=n?.email==="yveschen001@gmail.com";o.useEffect(()=>{m&&y()},[m]);const y=async()=>{r(!0),d("");try{const t=await u();s(t)}catch(t){d(t instanceof Error?t.message:"Unknown error occurred")}finally{r(!1)}},j=async()=>{h(!0);try{const t=await k(),x=new Blob([t],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),N=URL.createObjectURL(x);c.setAttribute("href",N),c.setAttribute("download",`typesprout-users-${new Date().toISOString().split("T")[0]}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(t){d(t instanceof Error?t.message:"Export failed")}finally{h(!1)}};return m?e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:a("admin.userEmailList")}),e.jsx("p",{className:"text-gray-600",children:a("admin.description")})]}),e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsx(f,{onClick:y,disabled:l,children:a(l?"ui.loading":"ui.refresh")}),e.jsx(f,{onClick:j,disabled:g||i.length===0,children:a(g?"ui.loading":"admin.exportCSV")})]}),p&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:p}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"UID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.displayName")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.createdAt")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.lastLogin")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map((t,x)=>e.jsxs("tr",{className:x%2===0?"bg-white":"bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900 font-mono",children:[t.uid.slice(0,8),"..."]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t.email}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t.displayName||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.createdAt?t.createdAt.toDate?t.createdAt.toDate().toLocaleDateString():t.createdAt:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.lastLogin?t.lastLogin.toDate?t.lastLogin.toDate().toLocaleDateString():t.lastLogin:"-"})]},t.uid))})]})})}),i.length===0&&!l&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:a("admin.noUserData")})]}):e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:a("admin.accessDenied")}),e.jsx("p",{className:"text-gray-600",children:a("admin.noPermission")})]})})}export{$ as default};
