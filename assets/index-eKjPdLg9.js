import{q as p,f as u,e as l,w as i,i as f,h as x,o as g,n as h,K as O}from"./index-D4RQrBUQ.js";const b=new Map,k=60*1e3;function C(o){const t=b.get(o);return t&&Date.now()-t.at<k?t.data:null}function v(o,t){b.set(o,{at:Date.now(),data:t})}async function G(){const o="googleUsersCount",t=C(o);if(t!=null)return console.log("getGoogleUsersCount: using cached value:",t),t;try{const n=p(u(l,"profiles"),i("email","!=","")),e=await f(n);console.log("getGoogleUsersCount: fetched profiles with email:",e.docs.length);const r=e.docs.filter(c=>{const s=c.data();return s.email&&s.email.trim()!==""});return console.log("getGoogleUsersCount: valid email users:",r.length),v(o,r.length),r.length}catch(n){return console.error("getGoogleUsersCount: error:",n),t??0}}async function N({lang:o,days:t=7,sampleLimit:n=500,uid:e}){const r=`attempts:${o||"*"}:${e||"*"}:${t}:${n}`,c=C(r);if(c)return c;try{const s=x.fromMillis(Date.now()-t*24*60*60*1e3);let a=p(u(l,"attempts"),i("ts",">=",s),g("ts","desc"),h(n));o&&(a=p(u(l,"attempts"),i("lang","==",o),i("ts",">=",s),g("ts","desc"),h(n))),e&&(a=p(u(l,"attempts"),i("uid","==",e),i("ts",">=",s),g("ts","desc"),h(n)));const y=(await f(a)).docs.map(m=>({id:m.id,...m.data()}));return v(r,y),y}catch{return c??[]}}function I(o,t=.2){if(o.length===0)return 0;const n=[...o].sort((s,a)=>s-a),e=Math.floor(n.length*(t/2)),r=n.slice(e,n.length-e);return r.reduce((s,a)=>s+a,0)/Math.max(1,r.length)}async function $(){const o="countryCounts",t=C(o);if(t)return t;try{const n=await f(p(u(l,"metrics_country"),h(300))),e={};if(n.empty){const r=await f(p(u(l,"profiles"),h(2e3)));for(const c of r.docs){const s=c.data()?.country;if(!s)continue;const a=s.toUpperCase();e[a]=(e[a]||0)+1}}else for(const r of n.docs){const c=r.id.toUpperCase(),s=Number(r.data()?.count||0);e[c]=s}return v(o,e),e}catch{return t??{}}}var d={exports:{}},T,R;function E(){if(R)return T;R=1;var o="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return T=o,T}var w,S;function W(){if(S)return w;S=1;var o=E();function t(){}function n(){}return n.resetWarningCache=t,w=function(){function e(s,a,q,y,m,U){if(U!==o){var P=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw P.name="Invariant Violation",P}}e.isRequired=e;function r(){return e}var c={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:r,element:e,elementType:e,instanceOf:r,node:e,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:n,resetWarningCache:t};return c.PropTypes=c,c},w}var _;function D(){return _||(_=1,d.exports=W()()),d.exports}var F=D();const j=O(F);export{j as P,G as a,$ as b,N as g,I as t};
