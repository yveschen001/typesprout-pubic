import{g as R,d as S,e as i,h as O,q as u,f,w as p,o as g,n as y,i as P,K as k}from"./index-Dtk1fXa2.js";const q=new Map,D=60*1e3;function b(r){const s=q.get(r);return s&&Date.now()-s.at<D?s.data:null}function h(r,s){q.set(r,{at:Date.now(),data:s})}async function $(){const r="googleUsersCount",s=b(r);if(s!=null)return s;try{const o=await R(S(i,"stats","site"));if(o.exists()){const e=Number(o.get("googleUsers")??0),n=Number.isFinite(e)?e:0;return h(r,n),n}const t=await R(S(i,"metrics_site","site"));if(t.exists()){const e=Number(t.get("googleUsers")??0),n=Number.isFinite(e)?e:0;return h(r,n),n}}catch{}return h(r,0),0}async function j({lang:r,days:s=7,sampleLimit:o=500,uid:t}){const e=`attempts:${r||"*"}:${t||"*"}:${s}:${o}`,n=b(e);if(n)return n;try{const c=O.fromMillis(Date.now()-s*24*60*60*1e3);let a=u(f(i,"attempts"),p("ts",">=",c),g("ts","desc"),y(o));r&&(a=u(f(i,"attempts"),p("lang","==",r),p("ts",">=",c),g("ts","desc"),y(o))),t&&(a=u(f(i,"attempts"),p("uid","==",t),p("ts",">=",c),g("ts","desc"),y(o)));const m=(await P(a)).docs.map(d=>({id:d.id,...d.data()}));return h(e,m),m}catch{return n??[]}}function A(r,s=.2){if(r.length===0)return 0;const o=[...r].sort((c,a)=>c-a),t=Math.floor(o.length*(s/2)),e=o.slice(t,o.length-t);return e.reduce((c,a)=>c+a,0)/Math.max(1,e.length)}async function B(){const r="countryCounts",s=b(r);if(s)return s;try{const o=await P(u(f(i,"metrics_country"),y(300))),t={};if(o.empty){const e=await P(u(f(i,"profiles"),y(2e3)));for(const n of e.docs){const c=n.data()?.country;if(!c)continue;const a=c.toUpperCase();t[a]=(t[a]||0)+1}}else for(const e of o.docs){const n=e.id.toUpperCase(),c=Number(e.data()?.count||0);t[n]=c}return h(r,t),t}catch{return s??{}}}var l={exports:{}},T,C;function U(){if(C)return T;C=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return T=r,T}var w,_;function W(){if(_)return w;_=1;var r=U();function s(){}function o(){}return o.resetWarningCache=s,w=function(){function t(c,a,F,m,d,N){if(N!==r){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:o,resetWarningCache:s};return n.PropTypes=n,n},w}var x;function E(){return x||(x=1,l.exports=W()()),l.exports}var M=E();const G=k(M);export{G as P,$ as a,B as b,j as g,A as t};
